<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="RecipeBook">
    <meta property="og:type" content="website">
    <meta property="og:description" content="Website for all the recipes">
    <meta property="og:image" content="https://www.flaticon.com/free-icons/recipe">
    <title>RecipeBook</title>
    <meta name="author" content="Yat Lam">
    <link rel="icon" href="./images/favicon-16x16.png" type="image/png" sizes="16x16">
    <link rel="stylesheet" href="recipe.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="recipe.js" type="module"></script>
    <script type="module" src="recipe.mjs"></script>

</head>
<body>
    <header>
        <section id="logo">
            <img src="./images/recipe-book.png" alt="Recipe Book Logo">
            <h1 class="web-name">RecipeBook</h1>
        </section>

        <section class="search-container">
            <form>
                <input id="search-input" type="text" placeholder="Find a recipe" name="search">
                <button id="search-button" type="button">
                    <i class="fa fa-search"></i>
                </button>
            </form>
        </section>
        <hr>
    </header>

    <main>
        <div class="recipes">
            <!-- Recipes will be dynamically injected here -->
        </div>
    </main>

    <footer>
        <div id="footer">
            <div id="social">
                <a href="#"><img src="images/instagram_icon.svg" alt="Instagram"></a>
                <a href="#"><img src="images/youtube_icon.svg" alt="YouTube"></a>
                <a href="#"><img src="images/pinterest_icon.svg" alt="Pinterest"></a>
            </div>
            <div id="reference">
                <a href="https://www.flaticon.com/free-icons/recipe" title="recipe icons">Icons by Freepik - Flaticon</a>
            </div>
        </div>
    </footer>
</body>
</html>

<script type="module">
import recipes from './recipes.mjs';

const randomIndex = max => Math.floor(Math.random() * max);

const chooseRandomItem = list => list[randomIndex(list.length)];

const createTagHTML = tags => {
    return `<div class="tags-container">${tags.map(tag => `<h3 class="category">${tag}</h3>`).join('')}</div>`;
};

const createRatingHTML = rating => {
    let stars = '';
    for (let i = 1; i <= 5; i++) {
        stars += `<span aria-hidden="true" class="${i <= rating ? 'icon-star' : 'icon-star-empty'}">${i <= rating ? '⭐' : '☆'}</span>`;
    }
    return `<span class="rating" role="img" aria-label="Rating: ${rating} out of 5 stars">${stars}</span>`;
};

const createRecipeHTML = ({ name, image, tags, rating, description }) => `
    <div class="recipe">
        <img class="food-img" src="${image}" alt="Image of ${name}">
        <div class="detail">
            ${createTagHTML(tags)}
            <h2 class="dessert-name">${name}</h2>
            ${createRatingHTML(rating)}
            <p>${description}</p>
        </div>
    </div>`;

const renderRecipes = recipesToDisplay => {
    const container = document.querySelector(".recipes");
    container.innerHTML = recipesToDisplay.length === 0
        ? `<h2 id="no-result">No Result Found</h2>`
        : recipesToDisplay.map(createRecipeHTML).join('');
};

const initializeApp = () => {
    const randomRecipe = chooseRandomItem(recipes);
    renderRecipes([randomRecipe]);
};

const recipeMatches = (recipe, query) => {
    const q = query.toLowerCase();
    return (
        recipe.name.toLowerCase().includes(q) ||
        recipe.tags.some(tag => tag.toLowerCase().includes(q)) ||
        recipe.description.toLowerCase().includes(q) ||
        recipe.recipeIngredient.some(ing => ing.toLowerCase().includes(q))
    );
};

const filterRecipes = query => recipes.filter(recipe => recipeMatches(recipe, query));

const handleSearchClick = () => {
    const searchTerm = document.querySelector("#search-input").value.toLowerCase();
    const results = filterRecipes(searchTerm).sort((a, b) => a.name.localeCompare(b.name));
    renderRecipes(results);
};

document.querySelector("#search-button").addEventListener("click", handleSearchClick);

initializeApp();
</script>
